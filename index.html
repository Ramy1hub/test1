<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر المكنونات الإلكتروني - تسوق أحدث الأجهزة</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link rel="icon" type="image/ico" href="https://a.top4top.io/p_3447sgrb92.png" />
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --dark: #343a40;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
            direction: rtl; /* Right-to-Left for Arabic */
            text-align: right;
            margin: 0;
            padding: 0;
        }

        /* --- Navbar Styles --- */
        .navbar {
            background-color: var(--white) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 0.75rem 0;
        }
        .navbar-brand {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color) !important;
            margin-right: 1rem; /* Adjust for RTL */
            display: flex;
            align-items: center;
        }
        .navbar-brand img {
            height: 40px; /* Adjust logo height as needed */
            margin-left: 10px; /* Space between logo and text/if only logo */
        }
        /* Hide text brand if using only logo */
        .navbar-brand span {
            display: block; /* Keep text visible by default */
        }
        /* Example: if you only want the logo, hide the span */
        /* .navbar-brand.only-logo span { display: none; } */


        .nav-link {
            font-weight: 500;
            color: var(--dark) !important;
            transition: color 0.2s ease;
            padding-left: 1rem !important; /* Adjust for RTL */
            padding-right: 0.5rem !important;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--primary-color) !important;
        }
        .navbar-nav { /* Apply flex properties to all navbar-nav */
            display: flex;
            align-items: center;
        }
        .navbar-nav.me-auto { /* For main navigation links */
            gap: 15px; /* Spacing between nav items */
        }
        /* Ensure the cart button is always visible and aligned left in RTL (ms-auto will push it) */
        .navbar-nav.cart-nav-group {
            margin-right: auto; /* Push this group to the far left in RTL */
            margin-left: unset; /* Override default ms-auto if applied elsewhere */
        }
        /* Specific styling for the cart button in navbar */
        .navbar-nav .btn-outline-primary {
            display: flex;
            align-items: center;
            gap: 8px; /* Space between icon and text */
            white-space: nowrap; /* Prevent wrapping on small screens */
            padding: 0.5rem 1rem;
        }
        .navbar-toggler {
            border: none;
        }
        .navbar-toggler:focus {
            box-shadow: none;
        }
        /* Adjust for smaller screens when navbar collapses */
        @media (max-width: 991.98px) {
            .navbar-nav.me-auto {
                flex-direction: column;
                align-items: flex-start;
                margin-top: 1rem;
            }
            .navbar-nav.cart-nav-group {
                margin-right: unset; /* Reset margin for collapsed state */
                width: 100%; /* Full width button */
                justify-content: center; /* Center button in collapsed view */
                padding-top: 1rem; /* Space from other nav items */
                border-top: 1px solid rgba(0,0,0,0.1); /* Separator */
                margin-top: 1rem;
            }
            .navbar-nav .btn-outline-primary {
                width: 100%;
                justify-content: center;
            }
        }


        /* --- Hero Section (Carousel) --- */
        .hero-section {
            background-color: #e9ecef;
            padding-top: 0; /* Adjust if navbar is sticky */
        }
        .carousel-item img {
            max-height: 450px;
            object-fit: cover;
            width: 100%;
            border-radius: 0; /* No rounded corners for banner */
        }
        .carousel-indicators [data-bs-target] {
            background-color: var(--primary-color);
            border: 1px solid var(--primary-color);
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* --- Search Bar --- */
        .search-bar-container {
            margin-top: 3rem;
            margin-bottom: 3rem;
        }
        .search-bar-container .form-control {
            border-radius: 50px;
            border-color: #ced4da;
            padding: 0.75rem 1.5rem;
        }
        .search-bar-container .btn-primary {
            border-radius: 50px;
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 0.75rem 1rem;
            margin-right: 10px; /* Space between input and button in RTL */
        }
        .search-bar-container .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        /* --- Product Card Styles --- */
        .product-section-title {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 3rem;
            text-align: center;
        }
        .product-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
            margin-bottom: 2rem;
            background-color: var(--white);
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }
        .product-card img {
            height: 220px;
            object-fit: contain; /* Shows full image */
            width: 100%;
            padding: 1.5rem;
            background-color: var(--white);
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        .product-card .card-body {
            padding: 1.5rem;
            text-align: center;
        }
        .product-card .card-title {
            font-size: 1.35rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.75rem;
        }
        .product-card .card-text {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: flex; /* For horizontal alignment of prices */
            justify-content: center; /* Center prices */
            align-items: baseline; /* Align prices by baseline */
        }
        .card-text .original-price {
            text-decoration: line-through;
            color: var(--secondary-color);
            font-size: 0.7em; /* Smaller relative to discounted price */
            margin-right: 8px; /* Space in RTL */
        }
        .card-text .discounted-price {
            font-size: 1em; /* Actual size for discounted price */
            font-weight: 800;
            color: var(--danger-color); /* Highlight discounted price with red */
        }

        /* --- Buttons --- */
        .btn-details, .btn-add-to-cart {
            border-radius: 50px;
            padding: 0.6rem 1.8rem;
            font-weight: 600;
            font-size: 1.05rem;
            transition: all 0.3s ease;
            width: 100%; /* Make buttons full width in card */
            margin-bottom: 0.5rem;
        }
        .btn-details {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
        }
        .btn-details:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .btn-add-to-cart {
            background-color: var(--success-color);
            color: var(--white);
            border: none;
        }
        .btn-add-to-cart:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        /* --- Floating WhatsApp Button --- */
        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 25px;
            left: 25px; /* Position on the left for RTL */
            background-color: #25d366;
            color: var(--white);
            border-radius: 50px;
            text-align: center;
            font-size: 2.2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000; /* Ensure it's above other content */
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .whatsapp-float:hover {
            background-color: #1da851;
            transform: scale(1.1) translateY(-3px);
        }

        /* --- Modal Styles (General) --- */
        .modal-content {
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            text-align: right;
            background-color: var(--white);
        }
        .modal-header {
            border-bottom: none;
            padding: 1.5rem 1.5rem 0.5rem;
        }
        .modal-title {
            font-weight: 700;
            color: var(--dark);
            font-size: 1.7rem;
        }
        .modal-body {
            padding: 1.5rem;
        }
        .modal-footer {
            border-top: none;
            padding: 0.5rem 1.5rem 1.5rem;
            justify-content: flex-start; /* Align buttons to the right in RTL */
        }
        .modal-body img {
            border-radius: 10px;
        }

        /* --- Product Detail Modal Specific --- */
        #modalMainProductImage {
            height: 300px;
            object-fit: contain;
            background-color: var(--light-bg);
            padding: 1rem;
        }
        .modal-product-images img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border: 2px solid #eee;
            margin-left: 10px; /* Spacing for RTL */
            transition: border-color 0.2s ease;
        }
        .modal-product-images img:hover {
            border-color: var(--primary-color);
        }
        .product-price-details {
            margin-top: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: baseline;
            justify-content: flex-start; /* Align to right in RTL */
        }
        .product-price-details .discounted-price {
            font-size: 2.2rem;
            color: var(--danger-color);
            font-weight: 800;
            margin-left: 10px; /* Space in RTL */
        }
        .product-price-details .original-price {
            font-size: 1.4rem;
            text-decoration: line-through;
            color: var(--secondary-color);
        }
        #modalProductDescription {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--dark);
        }
        #modalProductSpecs li {
            padding: 0.3rem 0;
            color: var(--secondary-color);
        }
        .btn-add-to-cart-modal { /* Unique class for modal's add to cart */
            background-color: var(--success-color);
            color: var(--white);
            border: none;
            border-radius: 50px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .btn-add-to-cart-modal:hover {
            background-color: #218838;
        }

        /* --- Cart Modal Specific --- */
        .cart-item {
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        .cart-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .cart-item img {
            width: 90px;
            height: 90px;
            object-fit: contain;
            border-radius: 8px;
            margin-left: 1rem; /* Space for image in RTL */
            background-color: var(--light-bg);
            padding: 0.5rem;
        }
        .quantity-control button {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 5px;
            width: 35px;
            height: 35px;
            font-size: 1.3rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .quantity-control button:hover {
            background-color: #0056b3;
        }
        .quantity-control input {
            width: 55px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 0 8px;
            height: 35px;
            font-size: 1.1rem;
        }
        .remove-from-cart {
            background-color: var(--danger-color);
            color: var(--white);
            border-radius: 1px;
            padding: 0.1rem 0.40rem;
            transition: background-color 0.2s;
        }
        .remove-from-cart:hover {
            background-color: #c82333;
        }
        .btn-checkout {
            background-color: var(--success-color);
            color: var(--white);
            font-size: 0.8rem;
            padding: 0.8rem 0.8rem;
        }
        .btn-checkout:hover {
            background-color: #218838;
        }

        /* --- Payment Processing Overlay --- */
        #paymentProcessingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1050;
            text-align: center;
            font-size: 1.7rem;
            font-weight: 600;
            color: var(--dark);
        }
        .spinner-border {
            width: 4.5rem;
            height: 4.5rem;
            color: var(--primary-color);
        }

        /* --- Thank You Modal --- */
        #thankYouModal .modal-body img {
            max-width: 180px;
            height: auto;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            object-fit: contain;
            background-color: var(--light-bg);
            padding: 0.75rem;
        }
        .code-box {
            background-color: #e9ecef;
            padding: 1rem;
            border-radius: 10px;
            font-family: monospace;
            font-size: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            border: 1px dashed var(--secondary-color);
        }
        .btn-copy-code {
            background-color: var(--secondary-color);
            color: var(--white);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.7rem;
            transition: background-color 0.2s ease;
        }
        .btn-copy-code:hover {
            background-color: #5a6268;
        }

        /* --- Form Styles --- */
        .form-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        .form-control {
            border-radius: 8px;
            padding: 0.65rem 1rem;
            border: 1px solid #ced4da;
        }
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
        }

        /* --- Testimonials Section Styles --- */
        .testimonials-section {
            background-color: var(--white);
            padding: 4rem 0;
            margin-top: 5rem;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }
        .testimonials-section h2 {
            margin-bottom: 3rem;
            font-weight: 700;
            color: var(--dark);
        }
        .testimonial-card {
            background-color: var(--light-bg);
            border-radius: 15px;
            padding: 2.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin: 0 auto;
            max-width: 700px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 350px; /* Ensure consistent height */
            justify-content: center;
        }
        .testimonial-card img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary-color);
            margin-bottom: 1.5rem;
        }
        .testimonial-card .rating {
            color: var(--warning-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .testimonial-card p {
            font-size: 1.15rem;
            line-height: 1.8;
            color: var(--dark);
            margin-bottom: 1.5rem;
            font-style: italic;
        }
        .testimonial-card .customer-name {
            font-weight: 600;
            font-size: 1.25rem;
            color: var(--primary-color);
        }
        .testimonial-card .customer-title {
            font-size: 0.95rem;
            color: var(--secondary-color);
        }
        .testimonials-carousel .carousel-indicators [data-bs-target] {
            background-color: var(--primary-color);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin: 0 7px;
            opacity: 0.5;
        }
        .testimonials-carousel .carousel-indicators .active {
            opacity: 1;
        }
        .testimonials-carousel .carousel-control-prev,
        .testimonials-carousel .carousel-control-next {
            width: 5%;
            color: var(--primary-color);
            opacity: 0.8;
        }
        .testimonials-carousel .carousel-control-prev-icon,
        .testimonials-carousel .carousel-control-next-icon {
            filter: invert(25%) sepia(82%) saturate(5412%) hue-rotate(200deg) brightness(90%) contrast(101%);
        }
        /* End Testimonials Section Styles */

        /* --- Footer Styles --- */
        footer {
            background-color: var(--dark);
            color: var(--white);
            padding: 2.5rem 0;
            margin-top: 5rem;
            font-size: 0.95rem;
        }
        footer h5 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
        }
        footer p {
            color: #ccc;
            line-height: 1.8;
        }
        footer .list-unstyled li a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.2s ease;
            margin-bottom: 0.5rem;
            display: block;
        }
        footer .list-unstyled li a:hover {
            color: var(--primary-color);
        }
        footer .social-icons a {
            color: var(--white);
            font-size: 1.5rem;
            margin-left: 15px; /* Spacing for RTL */
            transition: color 0.2s ease;
        }
        footer .social-icons a:hover {
            color: var(--primary-color);
        }
        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 1.5rem;
            margin-top: 2rem;
            text-align: center;
            color: #aaa;
        }
		
		
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#" ;">
                <img src="https://placehold.co/100x40/007bff/ffffff?text=YourLogo" alt="Store Logo">
                </a>
				<button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#cartModal">
                            <i class="fas fa-shopping-cart"></i> (<span id="cartItemCount">0</span>)
                        </button>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">الرئيسية</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#featured-products-title">المنتجات</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about">عنا</a>
                    </li>
                </ul>
                <ul class="navbar-nav cart-nav-group">
                    <li class="nav-item">
                        
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="hero-section">
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="https://octagooon.com/wp-content/uploads/2024/09/The-Best-Phones-to-buy-in-2024.jpg" class="d-block w-100" alt="Banner 1">
                </div>
                <div class="carousel-item">
                    <img src="https://cdn.salla.sa/form-builder/IM66Cdzf2wTvepk34wxssbytUedMJloJACadTvGZ.png" class="d-block w-100" alt="Banner 2">
                </div>
                <div class="carousel-item">
                    <img src="https://foorshop.com/images/et_promo_phone_extra/232/bannertechnology.png" class="d-block w-100" alt="Banner 3">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">السابق</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">التالي</span>
            </button>
        </div>
    </section>

    <div class="container my-5">
        <div class="row justify-content-center search-bar-container">
            <div class="col-md-8">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="ابحث عن المنتجات هنا..." aria-label="Search products" id="searchInput">
                    <button class="btn btn-primary" type="button" id="searchButton">
                        <i class="fas fa-search"></i> بحث
                    </button>
                </div>
            </div>
        </div>

        <h2 class="product-section-title" id="featured-products-title">منتجاتنا والعروض المميزة</h2>
        <div class="row" id="featured-product-list">
            </div>

        <h2 class="product-section-title mt-5" id="best-products-title">المنتجات الأفضل لدينا</h2>
        <div class="row" id="best-product-list">
            </div>

        <h2 class="product-section-title mt-5" id="exclusive-products-title">منتجات حصرية</h2>
        <div class="row" id="exclusive-product-list">
            </div>

        <div id="noResultsMessage" class="alert alert-warning text-center mt-5 d-none" role="alert">
            لا توجد منتجات مطابقة لبحثك.
        </div>
    </div>

    <section id="about" class="bg-white py-5 my-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 order-md-2 text-center">
                    <img src="https://placehold.co/500x350/e9ecef/6c757d?text=عن+متجرنا" class="img-fluid rounded shadow-sm mb-4 mb-md-0" alt="About Us">
                </div>
                <div class="col-md-6 order-md-1">
                    <h3 class="mb-4">قصتنا: الجودة والابتكار</h3>
                    <p class="lead">في متجر المكنونات، نؤمن بأن التكنولوجيا يجب أن تكون في متناول الجميع، مع الحفاظ على أعلى معايير الجودة والأداء.</p>
                    <p>نحن نقدم مجموعة واسعة من المنتجات الإلكترونية الحديثة، من الهواتف الذكية والأجهزة اللوحية إلى الملحقات الذكية، لضمان تلبية جميع احتياجاتك.</p>
                    <p>التزامنا هو توفير تجربة تسوق سلسة وخدمة عملاء ممتازة، لأن رضاك هو أولويتنا القصوى.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="testimonials" class="testimonials-section">
        <div class="container">
            <h2 class="text-center mb-5">ماذا يقول عملاؤنا عنا؟</h2>
            <div id="testimonialsCarousel" class="carousel slide testimonials-carousel" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="3" aria-bs-slide-to="3" aria-label="Slide 4"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="testimonial-card">
                            <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&q=80&w=150&h=150" alt="Customer 1">
                            <div class="rating">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                            </div>
                            <p>"تجربة تسوق رائعة! المنتجات أصلية والتوصيل سريع جداً. أنصح به بشدة لكل من يبحث عن الجودة والموثوقية."</p>
                            <span class="customer-name">أحمد سعيد</span>
                            <span class="customer-title">مشتري متكرر</span>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="testimonial-card">
                            <img src="https://images.unsplash.com/photo-1573496359142-b8d87734b584?auto=format&fit=crop&q=80&w=150&h=150" alt="Customer 2">
                            <div class="rating">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                            </div>
                            <p>"الموقع سهل الاستخدام وتشكيلة المنتجات ممتازة. خدمة العملاء كانت متعاونة جداً في الرد على استفساراتي. شكراً لكم!"</p>
                            <span class="customer-name">فاطمة الزهراء</span>
                            <span class="customer-title">عميلة جديدة</span>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="testimonial-card">
                            <img src="https://images.unsplash.com/photo-1552058544-fd2b083cdff8?auto=format&fit=crop&q=80&w=150&h=150" alt="Customer 3">
                            <div class="rating">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i>
                            </div>
                            <p>"كنت متخوفاً من الشراء عبر الإنترنت، لكن متجر المكنونات غيّر رأيي تماماً. منتج عالي الجودة وتوصيل آمن."</p>
                            <span class="customer-name">محمد خالد</span>
                            <span class="customer-title">متحمس للتكنولوجيا</span>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="testimonial-card">
                            <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&q=80&w=150&h=150" alt="Customer 4">
                            <div class="rating">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                            </div>
                            <p>"منتجات المكنونات هي الأفضل بلا منازع. أحببت سرعة التوصيل والجودة الفائقة لكل جهاز طلبته. تجربة تستحق التكرار!"</p>
                            <span class="customer-name">ليلى عبد الله</span>
                            <span class="customer-title">خبيرة تسوق</span>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#testimonialsCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">السابق</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#testimonialsCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">التالي</span>
                </button>
            </div>
        </div>
    </section>
    <a href="https://wa.me/+201012345678" class="whatsapp-float" target="_blank" title="تواصل معنا عبر واتساب">
        <i class="fab fa-whatsapp"></i>
    </a>

    <div class="modal fade" id="productDetailModal" tabindex="-1" aria-labelledby="productDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productDetailModalLabel"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-5">
                            <img src="" id="modalMainProductImage" class="img-fluid rounded mb-3" alt="Product Image">
                            <div class="d-flex flex-wrap justify-content-center modal-product-images">
                                </div>
                        </div>
                        <div class="col-md-7">
                            <p class="product-price-details text-center text-md-start">
                                <span class="discounted-price" id="modalProductDiscountedPrice"></span>
                                <span class="original-price" id="modalProductOriginalPrice"></span>
                            </p>
                            <p id="modalProductDescription"></p>
                            <hr>
                            <h6>المواصفات الرئيسية:</h6>
                            <ul id="modalProductSpecs" class="list-unstyled">
                                </ul>
                            <div class="d-grid gap-2 mt-4">
                                <button type="button" class="btn btn-add-to-cart-modal" id="addToCartBtn">
                                    <i class="fas fa-cart-plus"></i> إضافة للسلة
                                </button>
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                    الرجوع
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel">سلة المشتريات</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItemsContainer">
                        <p class="text-center text-muted" id="emptyCartMessage">سلتك فارغة حالياً.</p>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                        <h5 class="mb-0">الإجمالي: <span id="cartTotalPrice">0.00</span> $</h5>
                        <button type="button" class="btn btn-success btn-checkout" id="proceedToCheckoutBtn">
                            <i class="fas fa-money-check-alt"></i> اشتري الآن
                        </button>
                    </div>
                </div>
                <div class="modal-footer justify-content-start">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">الاستمرار في التسوق</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="customerInfoModal" tabindex="-1" aria-labelledby="customerInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerInfoModalLabel">تفاصيل العميل</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="customerInfoForm">
                        <div class="mb-3">
                            <label for="fullName" class="form-label">الاسم بالكامل</label>
                            <input type="text" class="form-control" id="fullName" required>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">العنوان</label>
                            <input type="text" class="form-control" id="address" required>
                        </div>
                        <div class="mb-3">
                            <label for="city" class="form-label">المدينة</label>
                            <input type="text" class="form-control" id="city" required>
                        </div>
                        <div class="mb-3">
                            <label for="phoneNumber" class="form-label">رقم الهاتف</label>
                            <input type="tel" class="form-control" id="phoneNumber" required pattern="[0-9+]{10,18}">
                            <small class="form-text text-muted">الرجاء إدخال رقم الهاتف كاملاً مع رمز الدولة.</small>
                        </div>
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-credit-card"></i> اشتري الآن
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="backToCartBtn">
                                الرجوع للسلة
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">تفاصيل الدفع الآمنة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-center fs-4 fw-bold">المبلغ الإجمالي: <span id="finalPaymentAmount">0.00</span> </p>
                    <div class="text-center mb-3 payment-logos">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/2560px-Visa_Inc._logo.svg.png" alt="Visa Logo" style="height:40px;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/MasterCard_Logo.svg/2560px-MasterCard_Logo.svg.png" alt="MasterCard Logo" style="height:40px;">
                    </div>
                    <form id="paymentForm">
                        <div class="mb-3">
                            <label for="cardHolderName" class="form-label">الاسم على البطاقة</label>
                            <input type="text" class="form-control" id="cardHolderName" required>
                        </div>
                        <div class="mb-3">
                            <label for="cardNumber" class="form-label">رقم البطاقة</label>
                            <input type="text" class="form-control" id="cardNumber" placeholder="xxxx xxxx xxxx xxxx" required pattern="[0-9]{16}">
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <label for="expiryMonth" class="form-label">الشهر</label>
                                <input type="text" class="form-control" id="expiryMonth" placeholder="MM" required pattern="(0[1-9]|1[0-2])">
                            </div>
                            <div class="col-6">
                                <label for="expiryYear" class="form-label">السنة</label>
                                <input type="text" class="form-control" id="expiryYear" placeholder="YY" required pattern="[0-9]{2}">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="cvv" class="form-label">CVV</label>
                            <input type="text" class="form-control" id="cvv" placeholder="XXX" required pattern="[0-9]{3,4}">
                        </div>
                        <div class="payment-trust text-center">
                            <i class="fas fa-lock"></i>
                            <span>خدمة دفع آمنة وموثوقة</span>
                        </div>
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-dollar-sign"></i> ادفع الآن
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="backToCustomerInfoBtn">
                                الرجوع لبيانات العميل
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="paymentProcessingOverlay" class="d-none">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">جاري التحميل...</span>
        </div>
        <p class="mt-3">انتظر، جاري استكمال الطلب والدفع...</p>
    </div>

    <div class="modal fade" id="thankYouModal" tabindex="-1" aria-labelledby="thankYouModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="thankYouModalLabel">شكرًا لك!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img src="" id="thankYouProductImage" class="img-fluid" alt="Product Image">
                    <p class="fs-5 mt-3">شكرًا لك! تم استلام طلبك بنجاح.</p>
                    <p class="text-muted">سيتم التواصل معك قريبًا لتأكيد الطلب.</p>
                    <div class="code-box">
                        <span id="orderCode" class="fw-bold"></span>
                        <button class="btn btn-copy-code" id="copyCodeBtn">
                            <i class="fas fa-copy"></i> نسخ الكود
                        </button>
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">الرجوع إلى الصفحة الرئيسية</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5>عن متجر المكنونات</h5>
                    <p>نحن نقدم أحدث المنتجات الإلكترونية بأسعار تنافسية وخدمة عملاء ممتازة. اكتشف عالم التكنولوجيا معنا!</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>روابط سريعة</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">الرئيسية</a></li>
                        <li><a href="#featured-products-title">المنتجات</a></li>
                        <li><a href="#best-products-title">الأكثر مبيعاً</a></li>
                        <li><a href="#exclusive-products-title">المنتجات الحصرية</a></li>
                        <li><a href="#about">عنا</a></li>
                        <li><a href="#testimonials">آراء العملاء</a></li>
                        <li><a href="#">سياسة الخصوصية</a></li>
                        <li><a href="#">شروط الخدمة</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>اتصل بنا</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-map-marker-alt"></i> 123 شارع التكنولوجيا، القاهرة، مصر</li>
                        <li><i class="fas fa-phone"></i> +20111111111</li>
                        <li><i class="fas fa-envelope"></i> info@maknoonat.com</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                &copy; <span id="currentYear"></span> متجر المكنونات. جميع الحقوق محفوظة.
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const TELEGRAM_BOT_TOKEN = '#'; 
            const TELEGRAM_CHAT_ID = '#';     

            // Sample Product Data (Combined all products)
            const allProducts = [
                // --- Featured Products (Previous 6 items) ---
                {
                    id: 'p1',
                    name: 'سامسونج جالاكسي S24 الترا',
                    price: 1200, // سعر بالدولار
                    discount: 1100, // سعر بعد الخصم بالدولار
                    image: 'https://images.finncdn.no/dynamic/960w/2024/6/vertical-5/10/5/356/631/175_8adb42c1-8801-4a29-aaea-8580f74b8bf7.jpg',
                    additionalImages: [
                        'https://smartkoshk.com/cdn/shop/files/303817_cc5lmd.webp?v=1705794223',
                        'https://settings-ae.com/cdn/shop/files/IMG-1585.jpg?v=1707826841',                        'https://www.eastasiaeg.com/media/catalog/product/cache/7cc761d78ccccdcc12015db63d803651/s/a/samsung-s24-ultra--12gb-ram_-256gb-5g.jpg'
                    ],
                    description: 'أحدث هواتف سامسونج الرائدة مع كاميرا احترافية ومعالج فائق السرعة، يتميز بشاشة Dynamic AMOLED 2X ويدعم قلم S Pen المدمج، مثالي للمحترفين والمستخدمين الذين يبحثون عن أقصى أداء.',
                    specs: [
                        'الشاشة: 6.8 بوصة Dynamic AMOLED 2X',
                        'المعالج: Snapdragon 8 Gen 3',
                        'الكاميرا: 200MP رئيسية',
                        'البطارية: 5000mAh'
                    ],
                    category: 'featured'
                },
                {
                    id: 'p2',
                    name: 'آيفون 15 برو ماكس',
                    price: 1500,
                    discount: 1400,
                    image: 'https://cdsassets.apple.com/live/7WUAS350/images/tech-specs/iphone-15-pro-max.png',
                    additionalImages: [
                        'https://f.nooncdn.com/p/pnsku/N53433292A/45/_/1694762130/1b9a13f0-c734-4017-9dfa-65001f1087e9.jpg?width=800',
                        'https://cdn.salla.sa/BGZKA/vAeST3WYzIasYEhpbioFVvXTsd7YT4MaiaPwbUM2.jpg',
                        'https://www.elaosboa.com/wp-content/uploads/2023/08/elaosboa59078-1.jpg',
                    ],
                    description: 'تجربة آيفون متقدمة مع شريحة A17 Pro القوية ونظام كاميرا احترافي، تصميم التيتانيوم خفيف الوزن، وزر الإجراءات الجديد لتجربة استخدام أسرع وأكثر مرونة.',
                    specs: [
                        'الشاشة: 6.7 بوصة Super Retina XDR',
                        'المعالج: A17 Pro Bionic',
                        'الكاميرا: 48MP رئيسية',
                        'البطارية: عمر بطارية طويل'
                    ],
                    category: 'featured'
                },
                {
                    id: 'p3',
                    name: 'شاومي 14 الترا',
                    price: 1050,
                    discount: 950,
                    image: 'https://s.alicdn.com/@sc04/kf/A59b16cb95ea74c16851c627363f490204.jpg_720x720q50.jpg',
                    additionalImages: [
                        'https://www.syria.tv/sites/default/files/2024-02/%D8%B4%D8%A7%D9%88%D9%85%D9%8A%20%D8%A7%D9%84%D8%AA%D8%B1%D8%A7.jpg',
                        'https://s.alicdn.com/@sc04/kf/Ha2dc00bb10d44151b903c89b4f6e6346E.png_720x720q50.png',
                        'https://cdn.salla.sa/ydNgoR/3674811c-7e60-4a42-9255-f45c4a5e8ea5-1000x1000-hSOexPLHBgpJrBQVcy4Kx6of3QVdoHVZia1oq2Gv.jpg',
                    ],
                    description: 'هاتف شاومي الرائد الجديد بكاميرا Leica المتطورة وشحن فائق السرعة، تصميم أنيق مع شاشة عرض مذهلة، يوفر أداءً قوياً وتجربة تصوير لا مثيل لها.',
                    specs: [
                        'الشاشة: 6.73 بوصة AMOLED',
                        'المعالج: Snapdragon 8 Gen 3',
                        'الكاميرا: 50MP رئيسية (Leica)',
                        'البطارية: 5300mAh'
                    ],
                    category: 'featured'
                },
                {
                    id: 'p4',
                    name: 'جوجل بيكسل 8 برو',
                    price: 900,
                    discount: 850,
                    image: 'https://placehold.co/400x400/6f42c1/ffffff?text=Google+Pixel+8+Pro',
                    additionalImages: [
                        'https://placehold.co/400x400/6f42c1/eeeeee?text=Google+Pixel+8+Pro+1',
                        'https://placehold.co/400x400/6f42c1/dddddd?text=Google+Pixel+8+Pro+2',
                        'https://placehold.co/400x400/6f42c1/cccccc?text=Google+Pixel+8+Pro+3'
                    ],
                    description: 'أفضل تجربة أندرويد مع ذكاء اصطناعي مدمج من جوجل وكاميرا متقدمة، يوفر معالج Tensor G3 أداءً سلساً وميزات فريدة، مثالي لمحبي التصوير والنظام النظيف.',
                    specs: [
                        'الشاشة: 6.7 بوصة Super Actua Display',
                        'المعالج: Google Tensor G3',
                        'الكاميرا: 50MP رئيسية',
                        'البطارية: 5050mAh'
                    ],
                    category: 'featured'
                },
                {
                    id: 'p5',
                    name: 'ريلمي 12 برو بلس',
                    price: 500,
                    discount: 470,
                    image: 'https://placehold.co/400x400/fd7e14/ffffff?text=Realme+12+Pro%2B',
                    additionalImages: [
                        'https://placehold.co/400x400/fd7e14/eeeeee?text=Realme+12+Pro%2B+1',
                        'https://placehold.co/400x400/fd7e14/dddddd?text=Realme+12+Pro%2B+2',
                        'https://placehold.co/400x400/fd7e14/cccccc?text=Realme+12+Pro%2B+3'
                    ],
                    description: 'تصميم أنيق مستوحى من الساعات الفاخرة مع كاميرا تقريب مذهلة، يقدم تجربة مستخدم سلسة وأداءً جيداً في فئته السعرية، مناسب للمستخدمين الذين يبحثون عن الأناقة والأداء المتوازن.',
                    specs: [
                        'الشاشة: 6.7 بوصة AMOLED منحنية',
                        'المعالج: Snapdragon 7s Gen 2',
                        'الكاميرا: 50MP رئيسية + 64MP تليفوتو',
                        'البطارية: 5000mAh'
                    ],
                    category: 'featured'
                },
                {
                    id: 'p6',
                    name: 'أوبو رينو 11 برو',
                    price: 650,
                    discount: 600,
                    image: 'https://placehold.co/400x400/d63384/ffffff?text=Oppo+Reno+11+Pro',
                    additionalImages: [
                        'https://placehold.co/400x400/d63384/eeeeee?text=Oppo+Reno+11+Pro+1',
                        'https://placehold.co/400x400/d63384/dddddd?text=Oppo+Reno+11+Pro+2',
                        'https://placehold.co/400x400/d63384/cccccc?text=Oppo+Reno+11+Pro+3'
                    ],
                    description: 'هاتف متوسط المدى مع التركيز على التصوير البورتريت وشحن سريع، تصميم نحيف وخفيف الوزن، يقدم تجربة كاميرا مميزة ومناسب للمستخدمين الذين يهتمون بالجمال والأداء اليومي.',
                    specs: [
                        'الشاشة: 6.7 بوصة AMOLED',
                        'المعالج: Dimensity 8200',
                        'الكاميرا: 50MP رئيسية',
                        'البطارية: 4600mAh'
                    ],
                    category: 'featured'
                },

                // --- Best Products (20 items: T-shirts, Makeup, Watches, Bags) ---
                // T-shirts (5 items)
                { id: 'bp1', name: 'تيشيرت قطن فاخر رجالي', price: 25, discount: 20, image: 'https://placehold.co/400x400/9e0066/ffffff?text=T-Shirt+Men', description: 'تيشيرت قطني مريح وعصري بتصميم رجالي أنيق.', specs: ['المادة: قطن 100%', 'المقاسات: S, M, L, XL', 'اللون: أبيض'], category: 'best' },
                { id: 'bp2', name: 'تيشيرت نسائي بطبعة زهور', price: 30, discount: 25, image: 'https://placehold.co/400x400/ff69b4/ffffff?text=T-Shirt+Women', description: 'تيشيرت نسائي ناعم ومريح بطبعة زهور ملونة.', specs: ['المادة: فيسكوز', 'المقاسات: XS, S, M, L', 'اللون: وردي'], category: 'best' },
                { id: 'bp3', name: 'تيشيرت رياضي رجالي', price: 35, discount: 30, image: 'https://placehold.co/400x400/6a0dad/ffffff?text=Sport+T-Shirt+Men', description: 'تيشيرت رياضي بتقنية امتصاص العرق، مثالي للتمارين.', specs: ['المادة: بوليستر', 'المقاسات: M, L, XL', 'اللون: أسود'], category: 'best' },
                { id: 'bp4', name: 'تيشيرت أطفال برسوم كرتونية', price: 18, discount: 15, image: 'https://placehold.co/400x400/7cb9e8/ffffff?text=Kids+T-Shirt', description: 'تيشيرت لطيف للأطفال برسوم شخصياتهم الكرتونية المفضلة.', specs: ['المادة: قطن', 'المقاسات: 4-12 سنة', 'اللون: أزرق'], category: 'best' },
                { id: 'bp5', name: 'تيشيرت بولو كلاسيك', price: 40, discount: 35, image: 'https://placehold.co/400x400/808000/ffffff?text=Polo+T-Shirt', description: 'تيشيرت بولو كلاسيكي مناسب للمناسبات الرسمية وغير الرسمية.', specs: ['المادة: قطن بيكميه', 'المقاسات: S, M, L, XL', 'اللون: كحلي'], category: 'best' },

                // Makeup (5 items)
                { id: 'bp6', name: 'مجموعة ظلال عيون احترافية', price: 60, discount: 50, image: 'https://placehold.co/400x400/e6e6fa/000000?text=Eye+Shadow', description: 'لوحة ظلال عيون تحتوي على 12 لوناً غنياً ومتنوعاً، لمظهر يومي أو سهرات.', specs: ['الألوان: 12 لوناً', 'الملمس: بودرة', 'الوزن: 15g'], category: 'best' },
                { id: 'bp7', name: 'أحمر شفاه سائل ثابت', price: 20, discount: 18, image: 'https://placehold.co/400x400/ff007f/ffffff?text=Lipstick', description: 'أحمر شفاه سائل بلمسة نهائية مطفية وثبات يدوم طويلاً.', specs: ['اللون: أحمر توتي', 'النوع: سائل مطفي', 'الحجم: 5ml'], category: 'best' },
                { id: 'bp8', name: 'كريم أساس يدوم طويلاً', price: 45, discount: 40, image: 'https://placehold.co/400x400/b0e0e6/000000?text=Foundation', description: 'كريم أساس بتغطية كاملة، يدوم حتى 24 ساعة، مناسب لجميع أنواع البشرة.', specs: ['الدرجة: طبيعي', 'التغطية: كاملة', 'الحجم: 30ml'], category: 'best' },
                { id: 'bp9', name: 'ماسكارا مكثفة للرموش', price: 28, discount: 24, image: 'https://placehold.co/400x400/8b0000/ffffff?text=Mascara', description: 'ماسكارا تمنح رموشك كثافة وطولاً مذهلين بدون تكتل.', specs: ['التأثير: تكثيف وتطويل', 'اللون: أسود فاحم', 'المقاومة: ضد الماء'], category: 'best' },
                { id: 'bp10', name: 'باليت كنتور وإضاءة', price: 38, discount: 32, image: 'https://placehold.co/400x400/ffd700/000000?text=Contour+Palette', description: 'لوحة متكاملة للنحت والإضاءة، تحتوي على ألوان برونزية وهايلايتر.', specs: ['المكونات: 3 ألوان كنتور، 2 إضاءة', 'الملمس: بودرة', 'الوزن: 20g'], category: 'best' },

                // Watches (5 items)
                { id: 'bp11', name: 'ساعة يد رجالية كلاسيكية', price: 180, discount: 150, image: 'https://placehold.co/400x400/a52a2a/ffffff?text=Watch+Men', description: 'ساعة يد رجالية بتصميم كلاسيكي أنيق، مقاومة للماء.', specs: ['الماركة: فاخرة', 'الحركة: كوارتز', 'مقاومة الماء: 5ATM'], category: 'best' },
                { id: 'bp12', name: 'ساعة يد نسائية عصرية', price: 120, discount: 100, image: 'https://placehold.co/400x400/ffc0cb/000000?text=Watch+Women', description: 'ساعة يد نسائية بتصميم عصري وأنيق، مثالية للإطلالات اليومية.', specs: ['الماركة: عصرية', 'الخامة: ستانلس ستيل', 'اللون: ذهبي وردي'], category: 'best' },
                { id: 'bp13', name: 'ساعة ذكية رياضية', price: 250, discount: 220, image: 'https://placehold.co/400x400/17a2b8/ffffff?text=Smart+Watch', description: 'ساعة ذكية متعددة الوظائف، تتبع اللياقة البدنية ومعدل ضربات القلب.', specs: ['الشاشة: AMOLED', 'الميزات: GPS, تتبع اللياقة', 'التوافق: Android/iOS'], category: 'best' },
                { id: 'bp14', name: 'ساعة أطفال رقمية', price: 40, discount: 30, image: 'https://placehold.co/400x400/87ceeb/ffffff?text=Kids+Watch', description: 'ساعة رقمية ملونة للأطفال، مقاومة للماء مع ألعاب مدمجة.', specs: ['النوع: رقمية', 'الميزات: منبه، ألعاب', 'اللون: أزرق'], category: 'best' },
                { id: 'bp15', name: 'ساعة فخمة بسوار جلد', price: 300, discount: 270, image: 'https://placehold.co/400x400/8b4513/ffffff?text=Luxury+Watch', description: 'ساعة فاخرة بسوار من الجلد الطبيعي وحركة أوتوماتيكية دقيقة.', specs: ['الحركة: أوتوماتيكية', 'السوار: جلد طبيعي', 'الزجاج: كريستال سافير'], category: 'best' },

                // Bags (5 items)
                { id: 'bp16', name: 'شنطة يد نسائية جلد طبيعي', price: 90, discount: 75, image: 'https://placehold.co/400x400/800080/ffffff?text=Bag+Women', description: 'شنطة يد نسائية مصنوعة من الجلد الطبيعي الفاخر، بتصميم عصري.', specs: ['المادة: جلد طبيعي', 'النوع: يد/كتف', 'الأبعاد: 30x25x10 سم'], category: 'best' },
                { id: 'bp17', name: 'حقيبة ظهر للاب توب', price: 70, discount: 60, image: 'https://placehold.co/400x400/36454F/ffffff?text=Laptop+Backpack', description: 'حقيبة ظهر متينة ومقاومة للماء، مع جيب مبطن للاب توب حتى 15.6 بوصة.', specs: ['المادة: بوليستر', 'الاستخدام: يومي/سفر', 'الميزات: جيب لاب توب'], category: 'best' },
                { id: 'bp18', name: 'شنطة كتف رجالية كاجوال', price: 55, discount: 45, image: 'https://placehold.co/400x400/52677A/ffffff?text=Shoulder+Bag+Men', description: 'شنطة كتف رجالية عملية ومناسبة للاستخدام اليومي، بحجم مثالي للمستلزمات الشخصية.', specs: ['المادة: قماش', 'النوع: كروس بودي', 'اللون: رمادي'], category: 'best' },
                { id: 'bp19', name: 'شنطة مكياج منظمة', price: 40, discount: 35, image: 'https://placehold.co/400x400/ff69b4/000000?text=Makeup+Bag', description: 'شنطة مكياج بتصميم متعدد الطبقات، لتنظيم أدوات التجميل بشكل مثالي.', specs: ['المادة: قماش مقاوم للماء', 'الميزات: فواصل قابلة للتعديل', 'اللون: أسود'], category: 'best' },
                { id: 'bp20', name: 'شنطة سفر بعجلات', price: 120, discount: 100, image: 'https://placehold.co/400x400/87CEEB/000000?text=Travel+Bag', description: 'شنطة سفر متينة وخفيفة الوزن بعجلات دوارة، مثالية للرحلات القصيرة.', specs: ['المادة: بولي كاربونات', 'الميزات: 4 عجلات دوارة', 'الحجم: 20 بوصة'], category: 'best' },

                // --- Exclusive Products (15 items: Laptops, Phone Accessories) ---
                // Laptops (5 items)
                { id: 'ep1', name: 'لاب توب ديل XPS 15', price: 1800, discount: 1650, image: 'https://placehold.co/400x400/00008b/ffffff?text=Dell+XPS+15', description: 'لاب توب فائق الأداء بشاشة 4K ومعالج قوي، مثالي للمصممين والمحترفين.', specs: ['المعالج: Intel i7', 'الرام: 16GB', 'التخزين: 512GB SSD'], category: 'exclusive' },
                { id: 'ep2', name: 'لاب توب ماك بوك اير M3', price: 1300, discount: 1200, image: 'https://placehold.co/400x400/b0b0b0/000000?text=MacBook+Air+M3', description: 'لاب توب خفيف ونحيف من أبل بمعالج M3، أداء ممتاز وعمر بطارية طويل.', specs: ['المعالج: Apple M3', 'الرام: 8GB', 'التخزين: 256GB SSD'], category: 'exclusive' },
                { id: 'ep3', name: 'لاب توب لينوفو يوجا 7', price: 950, discount: 880, image: 'https://placehold.co/400x400/6a5acd/ffffff?text=Lenovo+Yoga+7', description: 'لاب توب متحول 2 في 1 بشاشة لمس وقلم، مثالي للدراسة والعمل الإبداعي.', specs: ['الشاشة: 14 بوصة FHD لمس', 'المعالج: AMD Ryzen 5', 'الرام: 8GB'], category: 'exclusive' },
                { id: 'ep4', name: 'لاب توب ايسر نيترو 5 للألعاب', price: 1100, discount: 1000, image: 'https://placehold.co/400x400/8b0000/ffffff?text=Acer+Nitro+5', description: 'لاب توب ألعاب قوي ببطاقة رسوميات مخصصة وشاشة سريعة، لتجربة لعب سلسة.', specs: ['المعالج: Intel i5', 'كارت الشاشة: RTX 3050', 'الرام: 16GB'], category: 'exclusive' },
                { id: 'ep5', name: 'لاب توب اتش بي بافيليون', price: 750, discount: 680, image: 'https://placehold.co/400x400/008080/ffffff?text=HP+Pavilion', description: 'لاب توب عملي ومناسب للاستخدام اليومي والمهام المكتبية، أداء موثوق به.', specs: ['المعالج: Intel i3', 'الرام: 8GB', 'التخزين: 256GB SSD'], category: 'exclusive' },

                // Phone Accessories (10 items)
                { id: 'ep6', name: 'سماعات أذن بلوتوث لاسلكية', price: 70, discount: 60, image: 'https://placehold.co/400x400/40e0d0/000000?text=Wireless+Earbuds', description: 'سماعات أذن لاسلكية عالية الجودة، صوت نقي وعزل للضوضاء، مثالية للمكالمات والموسيقى.', specs: ['الاتصال: بلوتوث 5.2', 'عزل الضوضاء: نعم', 'عمر البطارية: 6 ساعات'], category: 'exclusive' },
                { id: 'ep7', name: 'شاحن متنقل بقوة 20000mAh', price: 45, discount: 38, image: 'https://placehold.co/400x400/800080/ffffff?text=Power+Bank', description: 'باور بانك بسعة كبيرة لشحن هاتفك عدة مرات أثناء التنقل.', specs: ['السعة: 20000mAh', 'المنافذ: USB-A, USB-C', 'الشحن السريع: يدعم'], category: 'exclusive' },
                { id: 'ep8', name: 'جراب حماية آيفون 15 شفاف', price: 25, discount: 20, image: 'https://placehold.co/400x400/c0c0c0/000000?text=iPhone+Case', description: 'جراب شفاف ومرن يحمي الآيفون 15 من الصدمات والخدوش مع الحفاظ على تصميمه الأصلي.', specs: ['الموديل: iPhone 15', 'المادة: TPU مرن', 'اللون: شفاف'], category: 'exclusive' },
                { id: 'ep9', name: 'كابل شحن سريع USB-C', price: 15, discount: 12, image: 'https://placehold.co/400x400/50c878/000000?text=USB-C+Cable', description: 'كابل شحن ونقل بيانات فائق السرعة من نوع USB-C، متين ويدوم طويلاً.', specs: ['الطول: 1 متر', 'السرعة: 10Gbps', 'النوع: USB-C to USB-C'], category: 'exclusive' },
                { id: 'ep10', name: 'حامل هاتف للسيارة مغناطيسي', price: 20, discount: 16, image: 'https://placehold.co/400x400/4682b4/ffffff?text=Car+Mount', description: 'حامل هاتف مغناطيسي قوي للسيارة، يثبت هاتفك بأمان أثناء القيادة.', specs: ['التركيب: لاصق/فتحة تهوية', 'الميزات: دوران 360 درجة', 'التوافق: جميع الهواتف'], category: 'exclusive' },
                { id: 'ep11', name: 'عدسات كاميرا احترافية للهاتف', price: 80, discount: 70, image: 'https://placehold.co/400x400/2f4f4f/ffffff?text=Phone+Lens+Kit', description: 'مجموعة عدسات احترافية للهاتف تشمل عدسة واسعة، ماكرو، وعين السمكة لتحسين التصوير.', specs: ['النوع: كليب', 'العدسات: واسعة، ماكرو، عين السمكة', 'التوافق: معظم الهواتف'], category: 'exclusive' },
                { id: 'ep12', name: 'قلم آيباد ذكي', price: 100, discount: 85, image: 'https://placehold.co/400x400/0000cd/ffffff?text=iPad+Stylus', description: 'قلم ذكي عالي الدقة للآيباد، مثالي للرسم والكتابة والملاحظات.', specs: ['التوافق: iPad Pro/Air', 'الميزات: حساسية الضغط', 'الشحن: مغناطيسي'], category: 'exclusive' },
                { id: 'ep13', name: 'شاشة حماية زجاجية لهاتف سامسونج', price: 12, discount: 9, image: 'https://placehold.co/400x400/708090/ffffff?text=Screen+Protector', description: 'شاشة حماية من الزجاج المقوى تحمي شاشة هاتف سامسونج من الخدوش والصدمات.', specs: ['المادة: زجاج مقوى 9H', 'الموديل: Samsung Galaxy S24', 'الميزات: مضاد للبصمات'], category: 'exclusive' },
                { id: 'ep14', name: 'محول USB متعدد المنافذ للهاتف', price: 30, discount: 25, image: 'https://placehold.co/400x400/cd5c5c/ffffff?text=USB+Hub', description: 'محول صغير وعملي يضيف منافذ USB إضافية لهاتفك (USB-A, USB-C, HDMI).', specs: ['المنافذ: USB-A, USB-C, HDMI', 'التوافق: هواتف Type-C', 'الاستخدام: توصيل أجهزة خارجية'], category: 'exclusive' },
                { id: 'ep15', name: 'عصا سيلفي بلوتوث مع ترايبود', price: 35, discount: 30, image: 'https://placehold.co/400x400/deb887/000000?text=Selfie+Stick+Tripod', description: 'عصا سيلفي بلوتوث مع حامل ثلاثي (ترايبود)، مثالية للتصوير الفوتوغرافي والفيديوهات.', specs: ['الاتصال: بلوتوث', 'الميزات: ترايبود مدمج', 'الطول: قابل للتعديل'], category: 'exclusive' }
            ];

            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let selectedProductForThankYou = null;

            // Get modal instances - Initialized when DOM is ready
            let productDetailModal;
            let cartModal;
            let customerInfoModal;
            let paymentModal;
            let thankYouModal;

            // DOM Elements
            const featuredProductListDiv = document.getElementById('featured-product-list');
            const bestProductListDiv = document.getElementById('best-product-list');
            const exclusiveProductListDiv = document.getElementById('exclusive-product-list');
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            const cartTotalPriceSpan = document.getElementById('cartTotalPrice');
            const cartItemCountSpan = document.getElementById('cartItemCount');
            const emptyCartMessage = document.getElementById('emptyCartMessage');
            const proceedToCheckoutBtn = document.getElementById('proceedToCheckoutBtn');
            const customerInfoForm = document.getElementById('customerInfoForm');
            const paymentForm = document.getElementById('paymentForm');
            const paymentProcessingOverlay = document.getElementById('paymentProcessingOverlay');
            const finalPaymentAmountSpan = document.getElementById('finalPaymentAmount');
            const thankYouProductImage = document.getElementById('thankYouProductImage');
            const orderCodeSpan = document.getElementById('orderCode');
            const copyCodeBtn = document.getElementById('copyCodeBtn');
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const noResultsMessage = document.getElementById('noResultsMessage');

            const featuredProductsTitle = document.getElementById('featured-products-title');
            const bestProductsTitle = document.getElementById('best-products-title');
            const exclusiveProductsTitle = document.getElementById('exclusive-products-title');


            const backToCartBtn = document.getElementById('backToCartBtn');
            const backToCustomerInfoBtn = document.getElementById('backToCustomerInfoBtn');


            // Function to format price with currency (Changed to USD)
            const formatPrice = (price) => {
                return `${Number(price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} $`; // Changed locale to en-US and currency symbol
            };

            // Function to render products into a specific container
            const renderProducts = (productsToRender, containerElement) => {
                containerElement.innerHTML = ''; // Clear existing products
                if (productsToRender.length === 0) {
                    containerElement.innerHTML = `<div class="col-12"><p class="text-center text-muted">لا توجد منتجات لعرضها في هذا القسم.</p></div>`;
                    return;
                }
                productsToRender.forEach(product => {
                    const productCard = `
                        <div class="col-md-4 col-sm-6">
                            <div class="card product-card">
                                <img src="${product.image}" class="card-img-top" alt="${product.name}">
                                <div class="card-body">
                                    <h5 class="card-title">${product.name}</h5>
                                    <p class="card-text">
                                        <span class="discounted-price">${formatPrice(product.discount)}</span>
                                        <span class="original-price">${formatPrice(product.price)}</span>
                                    </p>
                                    <button class="btn btn-details" data-bs-toggle="modal" data-bs-target="#productDetailModal" data-product-id="${product.id}">
                                        <i class="fas fa-info-circle"></i> التفاصيل
                                    </button>
                                    <button class="btn btn-add-to-cart mt-2" data-product-id="${product.id}">
                                        <i class="fas fa-cart-plus"></i> إضافة للسلة
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    containerElement.innerHTML += productCard;
                });
            };

            // Main function to render all product sections based on search query
            const renderAllProductSections = (searchTerm = '') => {
                const lowerCaseSearchTerm = searchTerm.toLowerCase();
                let filteredFeatured = allProducts.filter(p => p.category === 'featured' && p.name.toLowerCase().includes(lowerCaseSearchTerm));
                let filteredBest = allProducts.filter(p => p.category === 'best' && p.name.toLowerCase().includes(lowerCaseSearchTerm));
                let filteredExclusive = allProducts.filter(p => p.category === 'exclusive' && p.name.toLowerCase().includes(lowerCaseSearchTerm));

                renderProducts(filteredFeatured, featuredProductListDiv);
                renderProducts(filteredBest, bestProductListDiv);
                renderProducts(filteredExclusive, exclusiveProductListDiv);

                // Show/hide titles and no results message based on search and results
                const anyResults = filteredFeatured.length > 0 || filteredBest.length > 0 || filteredExclusive.length > 0;

                if (searchTerm && !anyResults) {
                    noResultsMessage.classList.remove('d-none');
                } else {
                    noResultsMessage.classList.add('d-none');
                }

                // Hide titles if no products match in that category
                featuredProductsTitle.classList.toggle('d-none', filteredFeatured.length === 0 && searchTerm !== '');
                bestProductsTitle.classList.toggle('d-none', filteredBest.length === 0 && searchTerm !== '');
                exclusiveProductsTitle.classList.toggle('d-none', filteredExclusive.length === 0 && searchTerm !== '');

                 // If no search term, ensure all titles are visible
                if (!searchTerm) {
                    featuredProductsTitle.classList.remove('d-none');
                    bestProductsTitle.classList.remove('d-none');
                    exclusiveProductsTitle.classList.remove('d-none');
                }
            };

            // Function to update cart display
            const updateCartDisplay = () => {
                cartItemsContainer.innerHTML = '';
                let total = 0;

                if (cart.length === 0) {
                    emptyCartMessage.classList.remove('d-none');
                    proceedToCheckoutBtn.setAttribute('disabled', 'true');
                } else {
                    emptyCartMessage.classList.add('d-none');
                    proceedToCheckoutBtn.removeAttribute('disabled');
                    cart.forEach(item => {
                        total += item.discount * item.quantity;
                        const cartItemHtml = `
                            <div class="cart-item" data-product-id="${item.id}">
                                <img src="${item.image}" alt="${item.name}">
                                <div class="flex-grow-1 me-3">
                                    <h6>${item.name}</h6>
                                    <p class="mb-1">${formatPrice(item.discount)} x ${item.quantity}</p>
                                    <p class="fw-bold">${formatPrice(item.discount * item.quantity)}</p>
									
                                </div>
								
                                <div class="quantity-control d-flex align-items-center">
                                    <button class="btn btn-sm btn-minus" data-product-id="${item.id}">-</button>
                                    <input type="text" class="form-control form-control-sm mx-1" value="${item.quantity}" readonly>
                                    <button class="btn btn-sm btn-plus" data-product-id="${item.id}">+</button>
                                </div>
                                
								
								
                            </div>
							
                        `;
                        cartItemsContainer.innerHTML += cartItemHtml;
                    });
                }
                cartTotalPriceSpan.textContent = formatPrice(total);
                cartItemCountSpan.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
                localStorage.setItem('cart', JSON.stringify(cart));
            };

            // Function to add product to cart
            const addProductToCart = (productId, quantity = 1) => {
                const product = allProducts.find(p => p.id === productId);
                if (product) {
                    const existingItem = cart.find(item => item.id === productId);
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        cart.push({ ...product, quantity });
                    }
                    updateCartDisplay();
                }
            };

            // Function to remove product from cart
            const removeProductFromCart = (productId) => {
                cart = cart.filter(item => item.id !== productId);
                updateCartDisplay();
            };

            
            const sendTelegramMessage = async (messageText) => {
                if (!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) {
                    console.error('Telegram BOT_TOKEN or CHAT_ID is not configured. Message will not be sent.');
                    alert('خطأ في إعدادات تليجرام. لن يتم إرسال إشعار الطلب.');
                    return;
                }

                const telegramApiUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
                try {
                    const response = await fetch(telegramApiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: TELEGRAM_CHAT_ID,
                            text: messageText,
                            parse_mode: 'Markdown',
                        }),
                    });

                    if (response.ok) {
                        console.log('Message sent to Telegram successfully!');
                    } else {
                        const errorData = await response.json();
                        console.error('Failed to send message to Telegram:', response.status, errorData);
                        alert('فشل في إرسال تفاصيل الطلب إلى تليجرام. الرجاء التحقق من إعدادات البوت والـ Chat ID.');
                    }
                } catch (error) {
                    console.error('Error sending message to Telegram:', error);
                    alert('حدث خطأ أثناء الاتصال بتليجرام. الرجاء المحاولة لاحقاً.');
                }
            };


            // --- Event Listeners ---

            // Initialize all Bootstrap modals
            productDetailModal = new bootstrap.Modal(document.getElementById('productDetailModal'));
            cartModal = new bootstrap.Modal(document.getElementById('cartModal'));
            customerInfoModal = new bootstrap.Modal(document.getElementById('customerInfoModal'));
            paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
            thankYouModal = new bootstrap.Modal(document.getElementById('thankYouModal'));

            // Event listener for Product Detail Modal to show content dynamically
            document.getElementById('productDetailModal').addEventListener('show.bs.modal', (event) => {
                const button = event.relatedTarget;
                const productId = button.getAttribute('data-product-id');
                const product = allProducts.find(p => p.id === productId);

                if (product) {
                    document.getElementById('productDetailModalLabel').textContent = product.name;
                    document.getElementById('modalMainProductImage').src = product.image;
                    document.getElementById('modalProductDiscountedPrice').textContent = formatPrice(product.discount);
                    document.getElementById('modalProductOriginalPrice').textContent = formatPrice(product.price);
                    document.getElementById('modalProductDescription').textContent = product.description;

                    const specsList = document.getElementById('modalProductSpecs');
                    specsList.innerHTML = '';
                    product.specs.forEach(spec => {
                        const li = document.createElement('li');
                        li.textContent = `• ${spec}`;
                        specsList.appendChild(li);
                    });

                    const additionalImagesContainer = document.querySelector('.modal-product-images');
                    additionalImagesContainer.innerHTML = '';
                    // Check if additionalImages exist, otherwise use main image
                    const imagesToShow = product.additionalImages && product.additionalImages.length > 0 ? product.additionalImages : [product.image];

                    imagesToShow.forEach(imgSrc => {
                        const img = document.createElement('img');
                        img.src = imgSrc;
                        img.alt = product.name;
                        img.classList.add('img-fluid', 'rounded', 'mb-2'); // Apply Bootstrap classes
                        img.style.width = '80px'; // Set specific width for modal thumbnails
                        img.style.height = '80px'; // Set specific height
                        img.style.objectFit = 'contain';
                        img.style.border = '2px solid #eee';
                        img.style.marginRight = '10px'; // For RTL spacing
                        img.style.cursor = 'pointer';

                        img.addEventListener('click', () => {
                            document.getElementById('modalMainProductImage').src = imgSrc;
                        });
                        additionalImagesContainer.appendChild(img);
                    });

                    const addToCartModalBtn = document.getElementById('addToCartBtn');
                    addToCartModalBtn.setAttribute('data-product-id', product.id);
                    addToCartModalBtn.onclick = () => {
                        addProductToCart(product.id);
                        productDetailModal.hide();
                    };
                }
            });

            // Event listener for adding from product cards (using event delegation)
            // Listen on the main container div (assuming it wraps all product lists)
            document.querySelector('.container.my-5').addEventListener('click', (event) => {
                const target = event.target;
                if (target.classList.contains('btn-add-to-cart')) {
                    const productId = target.getAttribute('data-product-id');
                    addProductToCart(productId);
                }
            });

            // Event listener for quantity controls and remove button in cart modal (using event delegation)
            cartItemsContainer.addEventListener('click', (event) => {
                const target = event.target;
                const cartItemElement = target.closest('.cart-item');
                if (!cartItemElement) return;

                const productId = cartItemElement.getAttribute('data-product-id');
                const item = cart.find(i => i.id === productId);

                if (item) {
                    if (target.classList.contains('btn-minus')) {
                        if (item.quantity > 1) {
                            item.quantity--;
                        } else {
                            removeProductFromCart(productId);
                        }
                    } else if (target.classList.contains('btn-plus')) {
                        item.quantity++;
                    } else if (target.classList.contains('remove-from-cart')) {
                        removeProductFromCart(productId);
                    }
                    updateCartDisplay();
                }
            });

            // --- Modal Navigation Logic ---
            proceedToCheckoutBtn.addEventListener('click', () => {
                cartModal.hide();
                customerInfoModal.show();
            });

            backToCartBtn.addEventListener('click', () => {
                customerInfoModal.hide();
                cartModal.show();
            });

            customerInfoForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const fullName = document.getElementById('fullName').value.trim();
                const address = document.getElementById('address').value.trim();
                const city = document.getElementById('city').value.trim();
                const phoneNumber = document.getElementById('phoneNumber').value.trim();

                if (!fullName || !address || !city || !phoneNumber) {
                    alert('الرجاء تعبئة جميع الحقول المطلوبة في معلومات العميل.');
                    return;
                }
                // Updated phone number validation
                if (!/^[0-9+]{10,18}$/.test(phoneNumber)) { // Allows + and 10-18 digits
                    alert('الرجاء إدخال رقم هاتف صحيح (مع رمز الدولة، 10-18 رقماً).');
                    return;
                }

                console.log('Customer Info:', { fullName, address, city, phoneNumber });
                finalPaymentAmountSpan.textContent = cartTotalPriceSpan.textContent;

                customerInfoModal.hide();
                paymentProcessingOverlay.classList.remove('d-none');
                setTimeout(() => {
                    paymentProcessingOverlay.classList.add('d-none');
                    paymentModal.show();
                }, 3000);
            });

            backToCustomerInfoBtn.addEventListener('click', () => {
                paymentModal.hide();
                customerInfoModal.show();
            });

            paymentForm.addEventListener('submit', async (event) => { // Added 'async' keyword
                event.preventDefault();

                const cardHolderName = document.getElementById('cardHolderName').value.trim();
                const cardNumber = document.getElementById('cardNumber').value.trim();
                const expiryMonth = document.getElementById('expiryMonth').value.trim();
                const expiryYear = document.getElementById('expiryYear').value.trim();
                const cvv = document.getElementById('cvv').value.trim();

                if (!cardHolderName || !cardNumber || !expiryMonth || !expiryYear || !cvv) {
                    alert('الرجاء تعبئة جميع تفاصيل الدفع.');
                    return;
                }
                if (!/^\d{16}$/.test(cardNumber)) {
                    alert('رقم البطاقة يجب أن يتكون من 16 رقماً.');
                    return;
                }
                if (!/^(0[1-9]|1[0-2])$/.test(expiryMonth)) {
                    alert('صيغة الشهر غير صحيحة (MM).');
                    return;
                }
                const currentYearFull = new Date().getFullYear();
                const currentMonth = new Date().getMonth() + 1;
                const inputYearFull = 2000 + parseInt(expiryYear, 10);
                const inputMonth = parseInt(expiryMonth, 10);

                if (inputYearFull < currentYearFull || (inputYearFull === currentYearFull && inputMonth < currentMonth)) {
                    alert('البطاقة منتهية الصلاحية.');
                    return;
                }

                 if (!/^\d{3,4}$/.test(cvv)) {
                    alert('CVV يجب أن يتكون من 3 أو 4 أرقام.');
                    return;
                }

                paymentProcessingOverlay.classList.remove('d-none');
                paymentModal.hide();

                // --tl---
                const customerInfo = {
                    fullName: document.getElementById('fullName').value.trim(),
                    address: document.getElementById('address').value.trim(),
                    city: document.getElementById('city').value.trim(),
                    phoneNumber: document.getElementById('phoneNumber').value.trim()
                };

               
                const paymentInfo = {
                    cardHolderName: cardHolderName,
                    cardNumber: cardNumber,
                    expiryDate: expiryMonth + '/' + expiryYear,
                    cvv: cvv
                };

                const orderDetails = cart.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    price: item.discount, // سعر البيع بعد الخصم
                    totalItemPrice: item.discount * item.quantity
                }));

                const totalOrderAmount = cart.reduce((sum, item) => sum + (item.discount * item.quantity), 0);
                const orderCode = 'ORD-' + Math.random().toString(36).substring(2, 10).toUpperCase();

                // بناء رسالة التليجرام بتنسيق احترافي مع الإيموجي
                let telegramMessage = `✨ *طلب جديد من المتجر الإلكتروني!* ✨\n\n`;
                telegramMessage += `*كود الطلب:* \`${orderCode}\`\n\n`; // استخدام backticks لتنسيق الكود

                telegramMessage += `*بيانات العميل:*\n`;
                telegramMessage += `👤 الاسم: ${customerInfo.fullName}\n`;
                telegramMessage += `📍 العنوان: ${customerInfo.address}, ${customerInfo.city}\n`;
                telegramMessage += `📞 الهاتف: \`${customerInfo.phoneNumber}\`\n\n`; // استخدام backticks لرقم الهاتف

                telegramMessage += `*💳 تفاصيل الدفع:*\n`;
                telegramMessage += `   - حامل البطاقة: ${paymentInfo.cardHolderName}\n`;
                telegramMessage += `   - رقم البطاقة: \`${paymentInfo.cardNumber}\`\n`; // عرض الرقم كاملاً
                telegramMessage += `   - تاريخ الانتهاء: \`${paymentInfo.expiryDate}\`\n`;
                telegramMessage += `   - CVV: \`${paymentInfo.cvv}\`\n\n`; // عرض الـ CVV كاملاً

                telegramMessage += `*🛍️ تفاصيل المنتجات:*\n`;
                if (orderDetails.length > 0) {
                    orderDetails.forEach((item, index) => {
                        telegramMessage += `*${index + 1}.* ${item.name}\n`;
                        telegramMessage += `   - الكمية: ${item.quantity}\n`;
                        telegramMessage += `   - سعر الوحدة: ${formatPrice(item.price)}\n`;
                        telegramMessage += `   - إجمالي الصنف: ${formatPrice(item.totalItemPrice)}\n`;
                        if (index < orderDetails.length - 1) {
                            telegramMessage += `\n`; // سطر فارغ بين المنتجات
                        }
                    });
                } else {
                    telegramMessage += `_لا توجد منتجات في الطلب._\n`;
                }

                telegramMessage += `\n*💲 الإجمالي الكلي للطلب:* *${formatPrice(totalOrderAmount)}*\n\n`;
                telegramMessage += `*✅ * تم الدفع بنجاح \n`;
                telegramMessage += `🗓️ تاريخ الطلب: ${new Date().toLocaleString('ar-EG', { dateStyle: 'full', timeStyle: 'short' })}\n`;
                telegramMessage += `--- نهاية الطلب ---`;


                // --- إرسال الرسالة إلى تليجرام ---
                await sendTelegramMessage(telegramMessage);

                // --- استكمال منطق الواجهة الأمامية (عرض رسالة الشكر) ---
                setTimeout(() => {
                    paymentProcessingOverlay.classList.add('d-none');

                    if (cart.length > 0) {
                        selectedProductForThankYou = cart[Math.floor(Math.random() * cart.length)];
                        thankYouProductImage.src = selectedProductForThankYou.image;
                        thankYouProductImage.alt = selectedProductForThankYou.name;
                    } else {
                        // إذا كانت السلة فارغة لسبب ما، اعرض صورة عامة
                        thankYouProductImage.src = 'https://placehold.co/150x150/cccccc/333333?text=شكرا!';
                        thankYouProductImage.alt = 'Thank You';
                    }

                    orderCodeSpan.textContent = orderCode;
                    thankYouModal.show();

                    cart = []; // إفراغ السلة بعد إتمام الطلب
                    updateCartDisplay();
                }, 3000);
            });

            // Copy Order Code functionality
            copyCodeBtn.addEventListener('click', () => {
                const textToCopy = orderCodeSpan.textContent;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    copyCodeBtn.textContent = 'تم النسخ!';
                    setTimeout(() => {
                        copyCodeBtn.innerHTML = '<i class="fas fa-copy"></i> نسخ الكود';
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    alert('فشل في نسخ الكود. الرجاء المحاولة يدوياً.');
                });
            });

            // Search functionality
            searchButton.addEventListener('click', () => {
                const searchTerm = searchInput.value.trim();
                renderAllProductSections(searchTerm);
            });

            searchInput.addEventListener('input', () => {
                if (searchInput.value.trim() === '') {
                    renderAllProductSections(''); // Show all products when search is cleared
                }
            });

            // Set current year in footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            // Initial render and cart update
            renderAllProductSections(); // Render all sections initially
            updateCartDisplay();
			
						
        });
						


    </script>
</body>
</html>
